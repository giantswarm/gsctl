machine:
  services:
    - docker
  environment:
    GOPATH: "${HOME}/gsctl:${HOME}/gsctl/vendor"

dependencies:
  override:
    # set go environment
    - mkdir -p ${HOME}/.go_project/src/github.com/${CIRCLE_PROJECT_USERNAME}
    - ln -s ${HOME}/${CIRCLE_PROJECT_REPONAME} ${HOME}/.go_project/src/github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}
    # install kubectl
    - kubectl_version="$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)"
    - curl -s -LO https://storage.googleapis.com/kubernetes-release/release/${kubectl_version}/bin/linux/amd64/kubectl
    - chmod +x ./kubectl
    - sudo mv ./kubectl /usr/local/bin/kubectl

test:
  override:
    - go test ./...
    - make crosscompile
  post:
    - bash <(curl -s https://codecov.io/bash)
